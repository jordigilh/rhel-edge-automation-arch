- name: Download Fedora Images
  hosts: localhost
  vars:
    - initial_download_path: /tmp
  roles:
    - role: fedora-image-downloader
  tasks:
    - name: Set Nexus Credentials
      ansible.builtin.set_fact:
        nexus_password: "{{ lookup('file','/var/secrets/nexus-rfe-credentials/password') }}"
        nexus_username: "{{ lookup('file','/var/secrets/nexus-rfe-credentials/username')}}"
      no_log: true

    - name: Upload Images to Nexus
      ansible.builtin.include_role:
        name: content-download-upload
        tasks_from: upload-rfe-artifact.yaml
      vars:
        file_to_upload: "{{ initial_download_path }}/{{ item.item.split('/') | last }}"
        nexus_repository: rfe-rhel-media
        skip_httpd_upload: true
      loop: "{{ image_urls.results }}"